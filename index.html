<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="CaldaSpace - Advanced interactive web app showcasing NASA APIs with 3D visualizations, clickable source links, and comprehensive space data" />
  <title>CaldaSpace - Advanced NASA Space Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Three.js for 3D visualizations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
</head>
<body>
  <header>
    <div class="container">
      <h1>üöÄ CaldaSpace</h1>
      <p class="subtitle">Advanced space exploration with NASA's APIs, 3D visualizations & interactive data</p>
      <div class="theme-toggle">
        <label class="switch">
          <input type="checkbox" id="themeToggle" />
          <span class="slider"></span>
        </label>
        <span id="themeLabel">Light</span>
      </div>
    </div>
  </header>
  <main class="container">
    <!-- API Key Input Section -->
    <section class="api-key-section">
      <h2>Enter Your NASA API Key</h2>
      <p>
        Get your free API key at <a href="https://api.nasa.gov/" target="_blank" rel="noopener">api.nasa.gov</a>
      </p>
      <div class="input-group">
        <input type="text" id="apiKeyInput" placeholder="Enter your NASA API key" />
        <button id="saveApiKey">Save Key</button>
        <button id="testApiKey">Test Connection</button>
      </div>
      <p class="api-status" id="apiStatus"></p>
    </section>
    
    <!-- Dashboard Tabs -->
    <section class="dashboard-tabs">
      <button class="tab-btn active" data-tab="apod">Picture of the Day</button>
      <button class="tab-btn" data-tab="telescopes">Telescope Gallery</button>
      <button class="tab-btn" data-tab="mars">Mars Rover Photos</button>
      <button class="tab-btn" data-tab="neo">Near Earth Objects 3D</button>
    </section>
    
    <!-- APOD Tab -->
    <section class="tab-content active" id="apod">
      <h2>Astronomy Picture of the Day</h2>
      <p class="section-description">
        üîó <strong>Click on any image</strong> to visit the original NASA source page with full details and high-resolution downloads.
      </p>
      <div class="apod-controls row">
        <label> Select Date:
          <input type="date" id="apodDate" />
        </label>
        <button id="fetchApodDate">Load APOD</button>
        <button id="randomApod">Random APOD</button>
      </div>
      <div class="loading" id="apodLoading">Loading amazing space imagery...</div>
      <div class="content-card" id="apodContent"></div>
    </section>
    
    <!-- Telescope Gallery Tab -->
    <section class="tab-content" id="telescopes">
      <h2>Professional Telescope Archive</h2>
      <p class="section-description">
        Access imagery from NASA's Mikulski Archive for Space Telescopes (MAST). üîó <strong>Click images</strong> for source data, metadata, and FITS file downloads.
      </p>
      <div class="telescope-controls">
        <div class="row">
          <label>
            Telescope/Mission:
            <select id="telescopeSelect">
              <option value="all">All Missions</option>
              <option value="JWST">James Webb Space Telescope</option>
              <option value="HST">Hubble Space Telescope</option>
              <option value="TESS">Transiting Exoplanet Survey Satellite</option>
              <option value="KEPLER">Kepler</option>
              <option value="K2">K2</option>
              <option value="GALEX">Galaxy Evolution Explorer</option>
              <option value="SPITZER">Spitzer Space Telescope</option>
              <option value="WISE">Wide-field Infrared Survey Explorer</option>
            </select>
          </label>
          <label>
            View Mode:
            <select id="viewMode">
              <option value="gallery">Gallery View</option>
              <option value="timeline">Timeline View</option>
              <option value="advanced">Advanced Grid</option>
            </select>
          </label>
        </div>
        <div class="row">
          <label>
            Start Date:
            <input type="date" id="telescopeStartDate" value="1995-06-16" />
          </label>
          <label>
            End Date:
            <input type="date" id="telescopeEndDate" />
          </label>
          <label>
            Images to Load:
            <input type="number" id="imageCount" value="25" min="1" max="100" />
          </label>
          <button id="fetchTelescopeImages">Load Images</button>
        </div>
      </div>
      <div class="loading" id="telescopeLoading">Loading telescope imagery...</div>
      <div class="error-message" id="telescopeError" style="display: none;"></div>
      <div class="photo-grid" id="telescopeContent"></div>
    </section>
    
    <!-- Mars Rover Tab -->
    <section class="tab-content" id="mars">
      <h2>Mars Rover Photos</h2>
      <p class="section-description">
        Explore Mars through the eyes of NASA's rovers. üîó <strong>Click images</strong> to view full resolution and mission details.
      </p>
      <div class="mars-controls row">
        <select id="roverSelect">
          <option value="curiosity">Curiosity</option>
          <option value="perseverance">Perseverance</option>
          <option value="opportunity">Opportunity</option>
          <option value="spirit">Spirit</option>
        </select>
        <input type="date" id="marsDate" />
        <button id="fetchMarsPhotos">Fetch Photos</button>
        <button id="marsLatestPhotos">Latest Photos</button>
      </div>
      <div class="loading" id="marsLoading">Loading Mars imagery...</div>
      <div class="photo-grid" id="marsContent"></div>
    </section>
    
    <!-- NEO Tab with 3D Visualization -->
    <section class="tab-content" id="neo">
      <h2>Near Earth Objects - 3D Interactive Visualization</h2>
      <p class="section-description">
        üåç Interactive 3D visualization of Near Earth Objects around our planet. Explore orbital paths, sizes, and trajectories including comet 3I/Atlas.
      </p>
      
      <!-- NEO Controls -->
      <div class="neo-controls-panel">
        <div class="neo-controls row">
          <label> Start Date:
            <input type="date" id="neoStartDate" />
          </label>
          <label> End Date:
            <input type="date" id="neoEndDate" />
          </label>
          <label> Max Distance (AU):
            <input type="number" id="neoMaxDistance" value="0.05" step="0.01" min="0.01" max="10" />
          </label>
          <button id="fetchNeoData">Load NEO Data</button>
        </div>
        <div class="neo-view-controls row">
          <label>
            <input type="checkbox" id="show3D" checked /> 3D Visualization
          </label>
          <label>
            <input type="checkbox" id="showOrbits" checked /> Show Orbits
          </label>
          <label>
            <input type="checkbox" id="showComet3I" /> Include Comet 3I/Atlas
          </label>
          <label>
            Speed:
            <input type="range" id="animationSpeed" min="0.1" max="5" step="0.1" value="1" />
          </label>
          <button id="resetView">Reset View</button>
        </div>
      </div>
      
      <!-- 3D Canvas Container -->
      <div class="neo-3d-container">
        <canvas id="neo3DCanvas" width="800" height="600"></canvas>
        <div class="neo-info-panel" id="neoInfoPanel">
          <h4>NEO Information</h4>
          <div id="neoDetails">Select a NEO to view details</div>
        </div>
      </div>
      
      <div class="loading" id="neoLoading">Loading Near Earth Objects...</div>
      <div class="neo-stats" id="neoStats"></div>
      <div class="content-list" id="neoContent"></div>
    </section>
  </main>
  
  <footer>
    <div class="container">
      ¬© 2025 CaldaSpace | Advanced Space Exploration Dashboard | Data provided by NASA's Open APIs & MAST Archive
      <br>
      <small>üîó All images and data are clickable to access original sources and detailed information</small>
    </div>
  </footer>

  <!-- Enhanced MAST Data Preview Modal -->
  <div class="modal" id="mastModal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">Space Data Preview</h3>
        <button class="close-modal" id="closeModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="modal-tabs">
          <button class="modal-tab active" data-modal-tab="preview">Image Preview</button>
          <button class="modal-tab" data-modal-tab="metadata">Metadata</button>
          <button class="modal-tab" data-modal-tab="source">Source & Downloads</button>
        </div>
        <div class="modal-tab-content active" id="preview-content">
          <img id="previewImage" src="" alt="" style="max-width: 100%; height: auto;" />
          <div id="imageInfo" class="image-info"></div>
        </div>
        <div class="modal-tab-content" id="metadata-content">
          <div class="metadata-grid" id="metadataGrid"></div>
        </div>
        <div class="modal-tab-content" id="source-content">
          <div class="source-links" id="sourceLinks">
            <p>Access original data sources and downloads:</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Source Attribution Modal -->
  <div class="modal" id="sourceModal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="sourceModalTitle">Source Information</h3>
        <button class="close-modal" id="closeSourceModal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="sourceModalContent"></div>
      </div>
    </div>
  </div>

  <script type="module" src="js/app.js"></script>
  <script>
    // Enhanced Light/Dark theme toggle
    (function () {
      const toggle = document.getElementById('themeToggle');
      const label = document.getElementById('themeLabel');
      const saved = localStorage.getItem('caldaspace_theme') || 'light';
      document.documentElement.setAttribute('data-theme', saved);
      if (saved === 'dark') {
        toggle.checked = true;
        label.textContent = 'Dark';
      }
      toggle?.addEventListener('change', () => {
        const theme = toggle.checked ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', theme);
        label.textContent = toggle.checked ? 'Dark' : 'Light';
        localStorage.setItem('caldaspace_theme', theme);
      });
    })();

    // Enhanced Modal functionality
    (function() {
      const modals = document.querySelectorAll('.modal');
      const closeButtons = document.querySelectorAll('.close-modal');
      
      // Close modal functionality
      closeButtons.forEach(button => {
        button.addEventListener('click', (e) => {
          const modal = e.target.closest('.modal');
          if (modal) modal.style.display = 'none';
        });
      });
      
      // Close modals on outside click
      modals.forEach(modal => {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.style.display = 'none';
          }
        });
      });
      
      // Enhanced modal tab switching
      const modalTabs = document.querySelectorAll('.modal-tab');
      modalTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const targetTab = tab.dataset.modalTab;
          const modal = tab.closest('.modal');
          const modalTabContents = modal.querySelectorAll('.modal-tab-content');
          const modalTabButtons = modal.querySelectorAll('.modal-tab');
          
          // Update active tab
          modalTabButtons.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          // Update active content
          modalTabContents.forEach(content => {
            content.classList.remove('active');
            if (content.id === `${targetTab}-content`) {
              content.classList.add('active');
            }
          });
        });
      });
    })();
  </script>
</body>
</html>